{"ast":null,"code":"// File: src/pages/LeaveMessagePage.jsx\nimport{useEffect,useState}from\"react\";import{useNavigate}from\"react-router-dom\";import{supabase}from\"../supabaseClient\";import{toast}from\"react-hot-toast\";import Backdrop from\"../components/Backdrop\";import Card from\"../components/Card\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MAX_LEN=500;export default function LeaveMessagePage(){const[text,setText]=useState(\"\");const[submitting,setSubmitting]=useState(false);const[user,setUser]=useState(null);const navigate=useNavigate();// Load session user\nuseEffect(()=>{let cancelled=false;(async _data$session=>{const{data,error}=await supabase.auth.getSession();if(!cancelled)setUser(error?null:(data===null||data===void 0?void 0:(_data$session=data.session)===null||_data$session===void 0?void 0:_data$session.user)||null);})();return()=>{cancelled=true;};},[]);const submit=async e=>{e.preventDefault();const value=(text||\"\").trim();if(!value)return toast.error(\"Please write a message first.\");if(value.length>MAX_LEN)return toast.error(\"Message is too long.\");// Require login (avoids silent RLS failures)\nif(!user){toast(\"Please log in to leave a message.\");navigate(\"/login\");return;}setSubmitting(true);try{var _user$user_metadata,_user$user_metadata2,_user$email;const payload={text:value,user_id:user.id,// optional, handy for the wall\ndisplay_name:((_user$user_metadata=user.user_metadata)===null||_user$user_metadata===void 0?void 0:_user$user_metadata.full_name)||((_user$user_metadata2=user.user_metadata)===null||_user$user_metadata2===void 0?void 0:_user$user_metadata2.name)||((_user$email=user.email)===null||_user$email===void 0?void 0:_user$email.split(\"@\")[0])// let DB defaults set approved/is_public/created_at\n};const{error}=await supabase.from(\"guest_messages\").insert([payload]);if(error)throw error;toast.success(\"Message submitted!\");setText(\"\");// Go show it\nnavigate(\"/message-wall\",{replace:true});}catch(err){console.error(err);toast.error((err===null||err===void 0?void 0:err.message)||\"Could not submit message.\");}finally{setSubmitting(false);}};const remaining=Math.max(0,MAX_LEN-((text===null||text===void 0?void 0:text.length)||0));return/*#__PURE__*/_jsx(Backdrop,{children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-2xl mx-auto px-4 py-10\",children:/*#__PURE__*/_jsxs(Card,{className:\"p-6 text-black\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"section-title\",children:\"Leave a message for Abraham & Jesse\\u2011Lee \\uD83C\\uDF3B\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"mt-4 space-y-3\",onSubmit:submit,children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block\",htmlFor:\"guest_message\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"sr-only\",children:\"Your message\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"guest_message\",className:\"input h-32 w-full\",value:text,onChange:e=>setText(e.target.value),placeholder:\"Share your wishes\\u2026\",maxLength:MAX_LEN,\"aria-describedby\":\"msg_help\"})]}),/*#__PURE__*/_jsxs(\"div\",{id:\"msg_help\",className:\"text-xs \".concat(remaining<20?\"text-red-500\":\"text-soil-600\"),children:[remaining,\" characters left\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn-primary\",type:\"submit\",disabled:submitting,\"aria-busy\":submitting?\"true\":\"false\",children:submitting?\"Submittingâ€¦\":\"Submit\"})})]})]})})});}","map":{"version":3,"names":["useEffect","useState","useNavigate","supabase","toast","Backdrop","Card","jsx","_jsx","jsxs","_jsxs","MAX_LEN","LeaveMessagePage","text","setText","submitting","setSubmitting","user","setUser","navigate","cancelled","_data$session","data","error","auth","getSession","session","submit","e","preventDefault","value","trim","length","_user$user_metadata","_user$user_metadata2","_user$email","payload","user_id","id","display_name","user_metadata","full_name","name","email","split","from","insert","success","replace","err","console","message","remaining","Math","max","children","className","onSubmit","htmlFor","onChange","target","placeholder","maxLength","concat","type","disabled"],"sources":["C:/Users/drago/OneDrive/Desktop/sussa-troue/src/pages/LeaveMessagePage.jsx"],"sourcesContent":["// File: src/pages/LeaveMessagePage.jsx\nimport { useEffect, useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { supabase } from \"../supabaseClient\";\nimport { toast } from \"react-hot-toast\";\nimport Backdrop from \"../components/Backdrop\";\nimport Card from \"../components/Card\";\n\nconst MAX_LEN = 500;\n\nexport default function LeaveMessagePage() {\n  const [text, setText] = useState(\"\");\n  const [submitting, setSubmitting] = useState(false);\n  const [user, setUser] = useState(null);\n  const navigate = useNavigate();\n\n  // Load session user\n  useEffect(() => {\n    let cancelled = false;\n    (async () => {\n      const { data, error } = await supabase.auth.getSession();\n      if (!cancelled) setUser(error ? null : data?.session?.user || null);\n    })();\n    return () => {\n      cancelled = true;\n    };\n  }, []);\n\n  const submit = async (e) => {\n    e.preventDefault();\n\n    const value = (text || \"\").trim();\n    if (!value) return toast.error(\"Please write a message first.\");\n    if (value.length > MAX_LEN) return toast.error(\"Message is too long.\");\n\n    // Require login (avoids silent RLS failures)\n    if (!user) {\n      toast(\"Please log in to leave a message.\");\n      navigate(\"/login\");\n      return;\n    }\n\n    setSubmitting(true);\n    try {\n      const payload = {\n        text: value,\n        user_id: user.id,\n        // optional, handy for the wall\n        display_name:\n          user.user_metadata?.full_name ||\n          user.user_metadata?.name ||\n          user.email?.split(\"@\")[0],\n        // let DB defaults set approved/is_public/created_at\n      };\n\n      const { error } = await supabase.from(\"guest_messages\").insert([payload]);\n      if (error) throw error;\n\n      toast.success(\"Message submitted!\");\n      setText(\"\");\n      // Go show it\n      navigate(\"/message-wall\", { replace: true });\n    } catch (err) {\n      console.error(err);\n      toast.error(err?.message || \"Could not submit message.\");\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const remaining = Math.max(0, MAX_LEN - (text?.length || 0));\n\n  return (\n    <Backdrop>\n      <div className=\"max-w-2xl mx-auto px-4 py-10\">\n        <Card className=\"p-6 text-black\">\n          <h2 className=\"section-title\">Leave a message for Abraham & Jesseâ€‘Lee ðŸŒ»</h2>\n          <form className=\"mt-4 space-y-3\" onSubmit={submit}>\n            <label className=\"block\" htmlFor=\"guest_message\">\n              <span className=\"sr-only\">Your message</span>\n              <textarea\n                id=\"guest_message\"\n                className=\"input h-32 w-full\"\n                value={text}\n                onChange={(e) => setText(e.target.value)}\n                placeholder=\"Share your wishesâ€¦\"\n                maxLength={MAX_LEN}\n                aria-describedby=\"msg_help\"\n              />\n            </label>\n            <div\n              id=\"msg_help\"\n              className={`text-xs ${remaining < 20 ? \"text-red-500\" : \"text-soil-600\"}`}\n            >\n              {remaining} characters left\n            </div>\n\n            <div className=\"flex justify-end\">\n              <button\n                className=\"btn-primary\"\n                type=\"submit\"\n                disabled={submitting}\n                aria-busy={submitting ? \"true\" : \"false\"}\n              >\n                {submitting ? \"Submittingâ€¦\" : \"Submit\"}\n              </button>\n            </div>\n          </form>\n        </Card>\n      </div>\n    </Backdrop>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}