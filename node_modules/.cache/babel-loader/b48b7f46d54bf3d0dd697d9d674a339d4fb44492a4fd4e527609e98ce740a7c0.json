{"ast":null,"code":"// File: src/components/NavigationBar.jsx\nimport{Link,useLocation}from\"react-router-dom\";import{useEffect,useState}from\"react\";import{supabase}from\"../supabaseClient\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";export default function NavigationBar(){const[user,setUser]=useState(null);const[isAdmin,setIsAdmin]=useState(false);const[menuOpen,setMenuOpen]=useState(false);const[checkingAdmin,setCheckingAdmin]=useState(true);const location=useLocation();useEffect(()=>{let subscription;(async _result$data=>{const{data}=await supabase.auth.getUser();const u=(data===null||data===void 0?void 0:data.user)||null;setUser(u);await refreshIsAdmin(u);const result=supabase.auth.onAuthStateChange(async(_event,session)=>{const authUser=(session===null||session===void 0?void 0:session.user)||null;setUser(authUser);await refreshIsAdmin(authUser);});subscription=result===null||result===void 0?void 0:(_result$data=result.data)===null||_result$data===void 0?void 0:_result$data.subscription;})();return()=>{var _subscription,_subscription$unsubsc;return(_subscription=subscription)===null||_subscription===void 0?void 0:(_subscription$unsubsc=_subscription.unsubscribe)===null||_subscription$unsubsc===void 0?void 0:_subscription$unsubsc.call(_subscription);};},[]);useEffect(()=>{setMenuOpen(false);},[location.pathname]);async function refreshIsAdmin(u){setCheckingAdmin(true);try{var _u$user_metadata;if(!u){setIsAdmin(false);return;}// Check profiles table\nconst{data:prof,error}=await supabase.from(\"profiles\").select(\"is_admin\").eq(\"user_id\",u.id).limit(1).maybeSingle();if(!error&&prof&&typeof prof.is_admin===\"boolean\"){setIsAdmin(!!prof.is_admin);return;}// Fallback to user metadata\nconst metaFlag=(_u$user_metadata=u.user_metadata)===null||_u$user_metadata===void 0?void 0:_u$user_metadata.is_admin;setIsAdmin(!!metaFlag);}finally{setCheckingAdmin(false);}}const logout=async()=>{await supabase.auth.signOut();localStorage.removeItem(\"role\");window.location.href=\"/login\";};const NavLinks=_ref=>{let{onItemClick}=_ref;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Link,{className:\"btn-outline\",to:\"/album\",onClick:onItemClick,children:\"Album\"}),/*#__PURE__*/_jsx(Link,{className:\"btn-outline\",to:\"/message-wall\",onClick:onItemClick,children:\"Message Wall\"}),/*#__PURE__*/_jsx(Link,{className:\"btn-outline\",to:\"/leave-a-message\",onClick:onItemClick,children:\"Leave a Message\"}),/*#__PURE__*/_jsx(Link,{className:\"btn-outline\",to:\"/venue\",onClick:onItemClick,children:\"Venue\"}),user&&/*#__PURE__*/_jsx(Link,{className:\"btn-outline\",to:\"/upload-media\",onClick:onItemClick,children:\"Upload Media\"}),user&&!checkingAdmin&&isAdmin&&/*#__PURE__*/_jsx(Link,{className:\"btn-outline\",to:\"/admin\",onClick:onItemClick,children:\"Admin\"})]});};return/*#__PURE__*/_jsxs(\"nav\",{className:\"w-full bg-white/80 backdrop-blur border-b border-sunflower-100 sticky top-0 z-40\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-6xl mx-auto px-4 py-3 flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(Link,{to:user?\"/rsvp\":\"/login\",className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-2xl font-extrabold text-sunflower-700\",children:\"\\uD83C\\uDF3B\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-soil-700\",children:\"Abraham & Jesse-Lee\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"hidden md:flex items-center gap-3\",children:[/*#__PURE__*/_jsx(NavLinks,{}),user?/*#__PURE__*/_jsx(\"button\",{className:\"btn-primary\",onClick:logout,children:\"Logout\"}):/*#__PURE__*/_jsx(Link,{className:\"btn-primary\",to:\"/login\",children:\"Login\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"md:hidden btn-outline\",onClick:()=>setMenuOpen(s=>!s),children:menuOpen?\"Close\":\"Menu\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"md:hidden transition-[max-height] overflow-hidden \".concat(menuOpen?\"max-h-[480px]\":\"max-h-0\"),children:/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 pb-4 flex flex-col gap-2\",children:[/*#__PURE__*/_jsx(NavLinks,{onItemClick:()=>setMenuOpen(false)}),user?/*#__PURE__*/_jsx(\"button\",{className:\"btn-primary\",onClick:logout,children:\"Logout\"}):/*#__PURE__*/_jsx(Link,{className:\"btn-primary\",to:\"/login\",onClick:()=>setMenuOpen(false),children:\"Logout\"})]})})]});}","map":{"version":3,"names":["Link","useLocation","useEffect","useState","supabase","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","NavigationBar","user","setUser","isAdmin","setIsAdmin","menuOpen","setMenuOpen","checkingAdmin","setCheckingAdmin","location","subscription","_result$data","data","auth","getUser","u","refreshIsAdmin","result","onAuthStateChange","_event","session","authUser","_subscription","_subscription$unsubsc","unsubscribe","call","pathname","_u$user_metadata","prof","error","from","select","eq","id","limit","maybeSingle","is_admin","metaFlag","user_metadata","logout","signOut","localStorage","removeItem","window","href","NavLinks","_ref","onItemClick","children","className","to","onClick","s","concat"],"sources":["C:/Users/drago/OneDrive/Desktop/sussa-troue/src/components/NavigationBar.jsx"],"sourcesContent":["// File: src/components/NavigationBar.jsx\nimport { Link, useLocation } from \"react-router-dom\";\nimport { useEffect, useState } from \"react\";\nimport { supabase } from \"../supabaseClient\";\n\nexport default function NavigationBar() {\n  const [user, setUser] = useState(null);\n  const [isAdmin, setIsAdmin] = useState(false);\n  const [menuOpen, setMenuOpen] = useState(false);\n  const [checkingAdmin, setCheckingAdmin] = useState(true);\n  const location = useLocation();\n\n  useEffect(() => {\n    let subscription;\n    (async () => {\n      const { data } = await supabase.auth.getUser();\n      const u = data?.user || null;\n      setUser(u);\n      await refreshIsAdmin(u);\n\n      const result = supabase.auth.onAuthStateChange(async (_event, session) => {\n        const authUser = session?.user || null;\n        setUser(authUser);\n        await refreshIsAdmin(authUser);\n      });\n      subscription = result?.data?.subscription;\n    })();\n    return () => subscription?.unsubscribe?.();\n  }, []);\n\n  useEffect(() => {\n    setMenuOpen(false);\n  }, [location.pathname]);\n\n  async function refreshIsAdmin(u) {\n    setCheckingAdmin(true);\n    try {\n      if (!u) {\n        setIsAdmin(false);\n        return;\n      }\n\n      // Check profiles table\n      const { data: prof, error } = await supabase\n        .from(\"profiles\")\n        .select(\"is_admin\")\n        .eq(\"user_id\", u.id)\n        .limit(1)\n        .maybeSingle();\n\n      if (!error && prof && typeof prof.is_admin === \"boolean\") {\n        setIsAdmin(!!prof.is_admin);\n        return;\n      }\n\n      // Fallback to user metadata\n      const metaFlag = u.user_metadata?.is_admin;\n      setIsAdmin(!!metaFlag);\n    } finally {\n      setCheckingAdmin(false);\n    }\n  }\n\n  const logout = async () => {\n    await supabase.auth.signOut();\n    localStorage.removeItem(\"role\");\n    window.location.href = \"/login\";\n  };\n\n  const NavLinks = ({ onItemClick }) => (\n    <>\n      <Link className=\"btn-outline\" to=\"/album\" onClick={onItemClick}>\n        Album\n      </Link>\n      <Link className=\"btn-outline\" to=\"/message-wall\" onClick={onItemClick}>\n        Message Wall\n      </Link>\n      <Link className=\"btn-outline\" to=\"/leave-a-message\" onClick={onItemClick}>\n        Leave a Message\n      </Link>\n      <Link className=\"btn-outline\" to=\"/venue\" onClick={onItemClick}>\n        Venue\n      </Link>\n      {user && (\n        <Link className=\"btn-outline\" to=\"/upload-media\" onClick={onItemClick}>\n          Upload Media\n        </Link>\n      )}\n      {user && !checkingAdmin && isAdmin && (\n        <Link className=\"btn-outline\" to=\"/admin\" onClick={onItemClick}>\n          Admin\n        </Link>\n      )}\n    </>\n  );\n\n  return (\n    <nav className=\"w-full bg-white/80 backdrop-blur border-b border-sunflower-100 sticky top-0 z-40\">\n      <div className=\"max-w-6xl mx-auto px-4 py-3 flex items-center justify-between\">\n        <Link to={user ? \"/rsvp\" : \"/login\"} className=\"flex items-center gap-2\">\n          <span className=\"text-2xl font-extrabold text-sunflower-700\">ðŸŒ»</span>\n          <span className=\"font-bold text-soil-700\">Abraham & Jesse-Lee</span>\n        </Link>\n\n        {/* Desktop */}\n        <div className=\"hidden md:flex items-center gap-3\">\n          <NavLinks />\n          {user ? (\n            <button className=\"btn-primary\" onClick={logout}>\n              Logout\n            </button>\n          ) : (\n            <Link className=\"btn-primary\" to=\"/login\">\n              Login\n            </Link>\n          )}\n        </div>\n\n        {/* Mobile toggle */}\n        <button\n          className=\"md:hidden btn-outline\"\n          onClick={() => setMenuOpen((s) => !s)}\n        >\n          {menuOpen ? \"Close\" : \"Menu\"}\n        </button>\n      </div>\n\n      {/* Mobile menu */}\n      <div\n        className={`md:hidden transition-[max-height] overflow-hidden ${\n          menuOpen ? \"max-h-[480px]\" : \"max-h-0\"\n        }`}\n      >\n        <div className=\"px-4 pb-4 flex flex-col gap-2\">\n          <NavLinks onItemClick={() => setMenuOpen(false)} />\n          {user ? (\n            <button className=\"btn-primary\" onClick={logout}>\n              Logout\n            </button>\n          ) : (\n            <Link\n              className=\"btn-primary\"\n              to=\"/login\"\n              onClick={() => setMenuOpen(false)}\n            >\n              Logout\n            </Link>\n          )}\n        </div>\n      </div>\n    </nav>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}