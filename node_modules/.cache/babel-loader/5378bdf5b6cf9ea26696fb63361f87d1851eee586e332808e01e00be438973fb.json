{"ast":null,"code":"// File: src/App.jsx\nimport{useEffect,useState}from\"react\";import{BrowserRouter,Routes,Route,Navigate,useLocation,Outlet}from\"react-router-dom\";import{supabase}from\"./supabaseClient\";// PAGES\nimport LoginPage from\"./pages/LoginPage\";import RSVPPage from\"./pages/RSVPPage\";import ViewRSVPPage from\"./pages/ViewRSVPPage\";import AdminDashboard from\"./pages/AdminDashboard\";import WeddingAlbumPage from\"./pages/WeddingAlbumPage\";import MessageWallPage from\"./pages/MessageWallPage\";import LeaveMessagePage from\"./pages/LeaveMessagePage\";import VenuePage from\"./pages/VenuePage\";import UploadMediaPage from\"./pages/UploadMediaPage\";import NavigationBar from\"./components/NavigationBar\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function AppShell(){const[session,setSession]=useState(null);const[authLoading,setAuthLoading]=useState(true);useEffect(()=>{let sub;(async _res$data=>{const{data,error}=await supabase.auth.getSession();if(!error)setSession((data===null||data===void 0?void 0:data.session)||null);const res=supabase.auth.onAuthStateChange((_event,s)=>{setSession(s);});sub=res===null||res===void 0?void 0:(_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.subscription;setAuthLoading(false);})();return()=>{var _sub,_sub$unsubscribe;return(_sub=sub)===null||_sub===void 0?void 0:(_sub$unsubscribe=_sub.unsubscribe)===null||_sub$unsubscribe===void 0?void 0:_sub$unsubscribe.call(_sub);};},[]);if(authLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"span\",{children:\"Loading\\u2026\"})});}// Only show navbar when logged in (prevents flicker on /login)\nconst showNav=!!session;return/*#__PURE__*/_jsxs(_Fragment,{children:[showNav&&/*#__PURE__*/_jsx(NavigationBar,{}),/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(Navigate,{to:\"/login\",replace:true})}),/*#__PURE__*/_jsx(Route,{path:\"/login\",element:session?/*#__PURE__*/_jsx(Navigate,{to:\"/rsvp\",replace:true}):/*#__PURE__*/_jsx(LoginPage,{})}),/*#__PURE__*/_jsxs(Route,{element:/*#__PURE__*/_jsx(RequireAuth,{session:session}),children:[/*#__PURE__*/_jsx(Route,{path:\"/rsvp\",element:/*#__PURE__*/_jsx(RSVPPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/view-rsvp\",element:/*#__PURE__*/_jsx(ViewRSVPPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/album\",element:/*#__PURE__*/_jsx(WeddingAlbumPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/message-wall\",element:/*#__PURE__*/_jsx(MessageWallPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/leave-a-message\",element:/*#__PURE__*/_jsx(LeaveMessagePage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/venue\",element:/*#__PURE__*/_jsx(VenuePage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/upload-media\",element:/*#__PURE__*/_jsx(UploadMediaPage,{})}),/*#__PURE__*/_jsx(Route,{element:/*#__PURE__*/_jsx(RequireAdmin,{}),children:/*#__PURE__*/_jsx(Route,{path:\"/admin\",element:/*#__PURE__*/_jsx(AdminDashboard,{})})})]}),/*#__PURE__*/_jsx(Route,{path:\"*\",element:/*#__PURE__*/_jsx(Navigate,{to:\"/login\",replace:true})})]})]});}export default function App(){return/*#__PURE__*/_jsx(BrowserRouter,{children:/*#__PURE__*/_jsx(AppShell,{})});}function RequireAuth(_ref){let{session}=_ref;const location=useLocation();if(!session){return/*#__PURE__*/_jsx(Navigate,{to:\"/login\",replace:true,state:{from:location}});}return/*#__PURE__*/_jsx(Outlet,{});}function RequireAdmin(){const location=useLocation();const[checking,setChecking]=useState(true);const[allow,setAllow]=useState(false);useEffect(()=>{let mounted=true;(async _user$user_metadata=>{const{data}=await supabase.auth.getUser();const user=data===null||data===void 0?void 0:data.user;if(!user){if(mounted)setAllow(false);setChecking(false);return;}const{data:prof}=await supabase.from(\"profiles\").select(\"is_admin\").eq(\"user_id\",user.id).limit(1).maybeSingle();const flag=typeof(prof===null||prof===void 0?void 0:prof.is_admin)===\"boolean\"?prof.is_admin:!!((_user$user_metadata=user.user_metadata)!==null&&_user$user_metadata!==void 0&&_user$user_metadata.is_admin);if(mounted){setAllow(!!flag);setChecking(false);}})();return()=>{mounted=false;};},[]);if(checking){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-[40vh] flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"span\",{children:\"Checking admin\\u2026\"})});}if(!allow){return/*#__PURE__*/_jsx(Navigate,{to:\"/rsvp\",replace:true,state:{from:location}});}return/*#__PURE__*/_jsx(Outlet,{});}","map":{"version":3,"names":["useEffect","useState","BrowserRouter","Routes","Route","Navigate","useLocation","Outlet","supabase","LoginPage","RSVPPage","ViewRSVPPage","AdminDashboard","WeddingAlbumPage","MessageWallPage","LeaveMessagePage","VenuePage","UploadMediaPage","NavigationBar","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","AppShell","session","setSession","authLoading","setAuthLoading","sub","_res$data","data","error","auth","getSession","res","onAuthStateChange","_event","s","subscription","_sub","_sub$unsubscribe","unsubscribe","call","className","children","showNav","path","element","to","replace","RequireAuth","RequireAdmin","App","_ref","location","state","from","checking","setChecking","allow","setAllow","mounted","_user$user_metadata","getUser","user","prof","select","eq","id","limit","maybeSingle","flag","is_admin","user_metadata"],"sources":["C:/Users/drago/OneDrive/Desktop/sussa-troue/src/App.jsx"],"sourcesContent":["// File: src/App.jsx\nimport { useEffect, useState } from \"react\";\nimport {\n  BrowserRouter,\n  Routes,\n  Route,\n  Navigate,\n  useLocation,\n  Outlet,\n} from \"react-router-dom\";\nimport { supabase } from \"./supabaseClient\";\n\n// PAGES\nimport LoginPage from \"./pages/LoginPage\";\nimport RSVPPage from \"./pages/RSVPPage\";\nimport ViewRSVPPage from \"./pages/ViewRSVPPage\";\nimport AdminDashboard from \"./pages/AdminDashboard\";\nimport WeddingAlbumPage from \"./pages/WeddingAlbumPage\";\nimport MessageWallPage from \"./pages/MessageWallPage\";\nimport LeaveMessagePage from \"./pages/LeaveMessagePage\";\nimport VenuePage from \"./pages/VenuePage\";\nimport UploadMediaPage from \"./pages/UploadMediaPage\";\n\nimport NavigationBar from \"./components/NavigationBar\";\n\nfunction AppShell() {\n  const [session, setSession] = useState(null);\n  const [authLoading, setAuthLoading] = useState(true);\n\n  useEffect(() => {\n    let sub;\n    (async () => {\n      const { data, error } = await supabase.auth.getSession();\n      if (!error) setSession(data?.session || null);\n\n      const res = supabase.auth.onAuthStateChange((_event, s) => {\n        setSession(s);\n      });\n      sub = res?.data?.subscription;\n\n      setAuthLoading(false);\n    })();\n\n    return () => sub?.unsubscribe?.();\n  }, []);\n\n  if (authLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <span>Loading…</span>\n      </div>\n    );\n  }\n\n  // Only show navbar when logged in (prevents flicker on /login)\n  const showNav = !!session;\n\n  return (\n    <>\n      {showNav && <NavigationBar />}\n      <Routes>\n        {/* Always default to /login */}\n        <Route path=\"/\" element={<Navigate to=\"/login\" replace />} />\n\n        {/* Public: Login */}\n        <Route\n          path=\"/login\"\n          element={session ? <Navigate to=\"/rsvp\" replace /> : <LoginPage />}\n        />\n\n        {/* Protected routes */}\n        <Route element={<RequireAuth session={session} />}>\n          <Route path=\"/rsvp\" element={<RSVPPage />} />\n          <Route path=\"/view-rsvp\" element={<ViewRSVPPage />} />\n          <Route path=\"/album\" element={<WeddingAlbumPage />} />\n          <Route path=\"/message-wall\" element={<MessageWallPage />} />\n          <Route path=\"/leave-a-message\" element={<LeaveMessagePage />} />\n          <Route path=\"/venue\" element={<VenuePage />} />\n          <Route path=\"/upload-media\" element={<UploadMediaPage />} />\n\n          {/* Admin guard */}\n          <Route element={<RequireAdmin />}>\n            <Route path=\"/admin\" element={<AdminDashboard />} />\n          </Route>\n        </Route>\n\n        {/* Catch-all */}\n        <Route path=\"*\" element={<Navigate to=\"/login\" replace />} />\n      </Routes>\n    </>\n  );\n}\n\nexport default function App() {\n  return (\n    <BrowserRouter>\n      <AppShell />\n    </BrowserRouter>\n  );\n}\n\nfunction RequireAuth({ session }) {\n  const location = useLocation();\n  if (!session) {\n    return <Navigate to=\"/login\" replace state={{ from: location }} />;\n  }\n  return <Outlet />;\n}\n\nfunction RequireAdmin() {\n  const location = useLocation();\n  const [checking, setChecking] = useState(true);\n  const [allow, setAllow] = useState(false);\n\n  useEffect(() => {\n    let mounted = true;\n    (async () => {\n      const { data } = await supabase.auth.getUser();\n      const user = data?.user;\n      if (!user) {\n        if (mounted) setAllow(false);\n        setChecking(false);\n        return;\n      }\n\n      const { data: prof } = await supabase\n        .from(\"profiles\")\n        .select(\"is_admin\")\n        .eq(\"user_id\", user.id)\n        .limit(1)\n        .maybeSingle();\n\n      const flag =\n        typeof prof?.is_admin === \"boolean\"\n          ? prof.is_admin\n          : !!user.user_metadata?.is_admin;\n\n      if (mounted) {\n        setAllow(!!flag);\n        setChecking(false);\n      }\n    })();\n\n    return () => {\n      mounted = false;\n    };\n  }, []);\n\n  if (checking) {\n    return (\n      <div className=\"min-h-[40vh] flex items-center justify-center\">\n        <span>Checking admin…</span>\n      </div>\n    );\n  }\n\n  if (!allow) {\n    return <Navigate to=\"/rsvp\" replace state={{ from: location }} />;\n  }\n\n  return <Outlet />;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}